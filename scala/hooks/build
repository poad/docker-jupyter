#!/usr/bin/env sh
set -eux

echo "------ HOOK START - BUILD -------"
printenv

if [ "$DOCKERFILE_PATH" = "" ]; then
    DOCKERFILE_PATH_ARG=""
else
    DOCKERFILE_PATH_ARG="-f $DOCKERFILE_PATH"
fi

DOCKER_CONTENT_TRUST=1

docker build --build-arg BASE_TAG=${DOCKER_TAG} \
    --build-arg SBT_VERSION="1.6.1" \
    --build-arg SCALA_VERSION="2.13.4" \
    --build-arg ALMOND_VERSION="0.11.2" \
    --build-arg SCALA2_LATEST_VERSION="2.13.7" \
    --build-arg SCALA3_VERSION="3.0.4" \
    --progress=plain \
    --build-arg BUILDKIT_INLINE_CACHE=1 \
    ${DOCKERFILE_PATH_ARG} -t ${IMAGE_NAME} .

echo "------ HOOK END - BUILD -------"
